<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <title>Minha Conta - AlgExpress</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body>
<div class="relative flex size-full min-h-screen flex-col bg-gray-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    
    <!-- Header -->
    <header class="flex items-center justify-between whitespace-nowrap bg-white shadow-sm px-10 py-4">
        <div class="flex items-center gap-4 text-[#d2440e]">
            <div class="size-8">
                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4H42V17.3333V30.6667H24V44H6V30.6667V17.3333H24V4Z" fill="currentColor"></path>
                </svg>
            </div>
            <h1 class="text-[#d2440e] text-2xl font-bold leading-tight tracking-[-0.015em]">AlgExpress</h1>
        </div>
        <div class="flex gap-4">
            <a href="public_menu.html" class="text-[#d2440e] text-sm font-medium hover:text-red-600">Card√°pio</a>
            <button onclick="logout()" class="bg-[#d2440e] text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600">Sair</button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex justify-center p-8">
        <div class="w-full max-w-6xl">
            
            <!-- Welcome Section -->
            <div class="bg-gradient-to-r from-orange-500 to-red-500 rounded-xl shadow-lg p-8 mb-8 text-white">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold mb-2" id="welcomeMessage">Ol√°, Jo√£o!</h1>
                        <p class="text-orange-100">Bem-vindo de volta √† sua conta AlgExpress</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-white/20 rounded-full p-4 mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white" viewBox="0 0 256 256">
                                <path d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z"></path>
                            </svg>
                        </div>
                        <div class="text-sm">
                            <div class="font-semibold" id="loyaltyPoints">1.280 pontos</div>
                            <div class="text-orange-100">de fidelidade</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Left Side - Account Info -->
                <div class="lg:col-span-1 space-y-6">
                    
                    <!-- Profile Card -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-gray-900">Meu Perfil</h2>
                            <button onclick="editProfile()" class="text-orange-600 hover:text-orange-700 text-sm font-medium">Editar</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
                                <p class="text-gray-900" id="profileName">Jo√£o Silva Santos</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <p class="text-gray-900" id="profileEmail">joao@email.com</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                <p class="text-gray-900" id="profilePhone">(11) 99999-9999</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                                <p class="text-gray-900" id="profileCPF">123.456.789-00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Addresses -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-gray-900">Endere√ßos</h2>
                            <button onclick="addAddress()" class="text-orange-600 hover:text-orange-700 text-sm font-medium">Adicionar</button>
                        </div>
                        
                        <div id="addressesList" class="space-y-4">
                            <!-- Addresses will be loaded here -->
                        </div>
                    </div>

                    <!-- Loyalty Program -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Programa de Fidelidade</h2>
                        
                        <div class="bg-gradient-to-r from-purple-100 to-pink-100 rounded-lg p-4 mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-700">Pontos Atuais</span>
                                <span class="text-2xl font-bold text-purple-600" id="currentPoints">1.280</span>
                            </div>
                            <div class="w-full bg-white rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 64%"></div>
                            </div>
                            <p class="text-xs text-gray-600 mt-2">Faltam 720 pontos para ganhar uma pizza gr√°tis!</p>
                        </div>

                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">1 pedido = 10 pontos</span>
                                <span class="text-green-600">‚úì</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pizza gr√°tis = 2.000 pontos</span>
                                <span class="text-purple-600">üéÅ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Orders -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#3b82f6" viewBox="0 0 256 256">
                                    <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm40-68a12,12,0,0,1-12,12H116v28a12,12,0,0,1-24,0V160H64a12,12,0,0,1,0-24H92V108a12,12,0,0,1,24,0v28h28A12,12,0,0,1,168,148Z"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-gray-900" id="totalOrders">23</div>
                            <div class="text-sm text-gray-600">Pedidos feitos</div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#22c55e" viewBox="0 0 256 256">
                                    <path d="M176.49,95.51a12,12,0,0,1,0,17l-56,56a12,12,0,0,1-17,0l-24-24a12,12,0,1,1,17-17L112,143l47.51-47.52A12,12,0,0,1,176.49,95.51Z"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-gray-900" id="totalSpent">R$ 967</div>
                            <div class="text-sm text-gray-600">Total gasto</div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#f97316" viewBox="0 0 256 256">
                                    <path d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88.1,88.1,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,174,200.25c27.45-31.57,42-64.85,42-96.25A88.1,88.1,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-gray-900" id="favoritePizza">Margherita</div>
                            <div class="text-sm text-gray-600">Pizza favorita</div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-gray-900">Meus Pedidos</h2>
                            <div class="flex gap-2">
                                <button onclick="filterOrders('all')" class="px-3 py-1 bg-orange-100 text-orange-600 rounded-full text-sm font-medium" id="filterAll">Todos</button>
                                <button onclick="filterOrders('pending')" class="px-3 py-1 text-gray-600 rounded-full text-sm font-medium hover:bg-gray-100" id="filterPending">Pendentes</button>
                                <button onclick="filterOrders('delivered')" class="px-3 py-1 text-gray-600 rounded-full text-sm font-medium hover:bg-gray-100" id="filterDelivered">Entregues</button>
                            </div>
                        </div>
                        
                        <div id="ordersList" class="space-y-4">
                            <!-- Orders will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t py-6">
        <div class="max-w-4xl mx-auto px-8 text-center">
            <p class="text-sm text-gray-600">
                ¬© 2024 AlgExpress. Todos os direitos reservados. 
                <span class="mx-2">‚Ä¢</span>
                <a href="#" class="text-orange-600 hover:text-orange-700">Termos</a>
                <span class="mx-2">‚Ä¢</span>
                <a href="#" class="text-orange-600 hover:text-orange-700">Privacidade</a>
            </p>
        </div>
    </footer>
</div>

<!-- Add Address Modal -->
<div id="addressModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-bold text-gray-900 mb-4">Adicionar Endere√ßo</h3>
        
        <form id="addressForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">CEP *</label>
                <input type="text" id="newCep" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="00000-000">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Rua *</label>
                <input type="text" id="newStreet" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">N√∫mero *</label>
                    <input type="text" id="newNumber" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Complemento</label>
                    <input type="text" id="newComplement" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Bairro *</label>
                <input type="text" id="newNeighborhood" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Cidade *</label>
                <input type="text" id="newCity" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            </div>
        </form>

        <div class="flex gap-3 mt-6">
            <button class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-medium" onclick="closeAddressModal()">Cancelar</button>
            <button class="flex-1 bg-orange-600 text-white py-2 rounded-lg font-medium" onclick="saveAddress()">Salvar</button>
        </div>
    </div>
</div>

<script>
const API_BASE = 'http://localhost:8080/api/v1';

// Load user data
function loadUserData() {
    const user = JSON.parse(localStorage.getItem('algexpress_user') || 'null');
    if (!user) {
        window.location.href = 'customer_login.html';
        return;
    }
    
    // Update profile info
    document.getElementById('welcomeMessage').textContent = `Ol√°, ${user.name.split(' ')[0]}!`;
    document.getElementById('profileName').textContent = user.name;
    document.getElementById('profileEmail').textContent = user.email;
    document.getElementById('profilePhone').textContent = user.phone;
    document.getElementById('profileCPF').textContent = user.cpf;
    
    // Load additional data
    loadAddresses();
    loadOrders();
    loadLoyaltyInfo();
}

// Load addresses
function loadAddresses() {
    // API Call: GET /api/v1/clientes/{id}/enderecos
    console.log(`API Call: GET ${API_BASE}/clientes/1/enderecos`);
    
    // Mock data
    const addresses = [
        {
            id: 1,
            street: 'Rua das Flores, 123',
            neighborhood: 'Centro',
            city: 'S√£o Paulo',
            deliveryFee: 6.00
        },
        {
            id: 2,
            street: 'Av. Paulista, 456',
            neighborhood: 'Bela Vista',
            city: 'S√£o Paulo',
            deliveryFee: 7.50
        }
    ];
    
    const addressesList = document.getElementById('addressesList');
    if (addresses.length === 0) {
        addressesList.innerHTML = '<p class="text-gray-500 text-sm">Nenhum endere√ßo cadastrado</p>';
        return;
    }
    
    addressesList.innerHTML = addresses.map(address => `
        <div class="border border-gray-200 rounded-lg p-4">
            <div class="flex justify-between items-start">
                <div>
                    <p class="font-medium text-gray-900">${address.street}</p>
                    <p class="text-sm text-gray-600">${address.neighborhood}, ${address.city}</p>
                    <p class="text-xs text-gray-500">Taxa: R$ ${address.deliveryFee.toFixed(2)}</p>
                </div>
                <button onclick="removeAddress(${address.id})" class="text-red-600 hover:text-red-700 text-sm">Remover</button>
            </div>
        </div>
    `).join('');
}

// Load orders
function loadOrders() {
    // API Call: GET /api/v1/pedidos/customer/{id}
    console.log(`API Call: GET ${API_BASE}/pedidos/customer/1`);
    
    // Mock data
    const orders = [
        {
            id: 'ALG-001',
            date: '2024-08-10',
            status: 'DELIVERED',
            total: 47.90,
            items: ['Pizza Margherita (M)', 'Pizza Pepperoni (P)']
        },
        {
            id: 'ALG-002',
            date: '2024-08-12',
            status: 'PREPARING',
            total: 62.40,
            items: ['Pizza Quattro Formaggi (G)', 'Pizza Calabresa (M)']
        },
        {
            id: 'ALG-003',
            date: '2024-08-13',
            status: 'DELIVERED',
            total: 35.90,
            items: ['Pizza Margherita (M)']
        }
    ];
    
    renderOrders(orders);
}

// Render orders
function renderOrders(orders) {
    const ordersList = document.getElementById('ordersList');
    
    if (orders.length === 0) {
        ordersList.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum pedido encontrado</p>';
        return;
    }
    
    ordersList.innerHTML = orders.map(order => `
        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <div class="flex items-center gap-3">
                        <h3 class="font-semibold text-gray-900">Pedido #${order.id}</h3>
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusStyle(order.status)}">${getStatusText(order.status)}</span>
                    </div>
                    <p class="text-sm text-gray-600">${formatDate(order.date)}</p>
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-900">R$ ${order.total.toFixed(2)}</p>
                    <button onclick="reorderItems(${order.id})" class="text-orange-600 hover:text-orange-700 text-sm font-medium">Pedir novamente</button>
                </div>
            </div>
            <div class="text-sm text-gray-600">
                ${order.items.join(', ')}
            </div>
        </div>
    `).join('');
}

// Filter orders
function filterOrders(filter) {
    // Remove active class from all buttons
    document.querySelectorAll('[id^="filter"]').forEach(btn => {
        btn.classList.remove('bg-orange-100', 'text-orange-600');
        btn.classList.add('text-gray-600', 'hover:bg-gray-100');
    });
    
    // Add active class to selected button
    const activeBtn = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
    activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
    activeBtn.classList.add('bg-orange-100', 'text-orange-600');
    
    // Filter logic would go here
    console.log(`Filtering orders by: ${filter}`);
}

// Load loyalty info
function loadLoyaltyInfo() {
    // API Call: GET /api/v1/clientes/{id}/loyalty
    console.log(`API Call: GET ${API_BASE}/clientes/1/loyalty`);
    
    // Mock data
    const loyalty = {
        points: 1280,
        totalOrders: 23,
        totalSpent: 967.50,
        favoritePizza: 'Margherita'
    };
    
    document.getElementById('loyaltyPoints').textContent = `${loyalty.points} pontos`;
    document.getElementById('currentPoints').textContent = loyalty.points;
    document.getElementById('totalOrders').textContent = loyalty.totalOrders;
    document.getElementById('totalSpent').textContent = `R$ ${loyalty.totalSpent.toFixed(0)}`;
    document.getElementById('favoritePizza').textContent = loyalty.favoritePizza;
}

// Utility functions
function getStatusStyle(status) {
    switch (status) {
        case 'DELIVERED': return 'bg-green-100 text-green-800';
        case 'PREPARING': return 'bg-yellow-100 text-yellow-800';
        case 'IN_DELIVERY': return 'bg-blue-100 text-blue-800';
        case 'CANCELLED': return 'bg-red-100 text-red-800';
        default: return 'bg-gray-100 text-gray-800';
    }
}

function getStatusText(status) {
    switch (status) {
        case 'DELIVERED': return 'Entregue';
        case 'PREPARING': return 'Preparando';
        case 'IN_DELIVERY': return 'Em entrega';
        case 'CANCELLED': return 'Cancelado';
        default: return status;
    }
}

function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('pt-BR');
}

// Modal functions
function addAddress() {
    document.getElementById('addressModal').classList.remove('hidden');
    document.getElementById('addressModal').classList.add('flex');
}

function closeAddressModal() {
    document.getElementById('addressModal').classList.add('hidden');
    document.getElementById('addressModal').classList.remove('flex');
    document.getElementById('addressForm').reset();
}

function saveAddress() {
    // Validate form
    const requiredFields = ['newCep', 'newStreet', 'newNumber', 'newNeighborhood', 'newCity'];
    for (const fieldId of requiredFields) {
        if (!document.getElementById(fieldId).value.trim()) {
            alert('Por favor, preencha todos os campos obrigat√≥rios');
            return;
        }
    }
    
    const addressData = {
        cep: document.getElementById('newCep').value,
        street: document.getElementById('newStreet').value,
        number: document.getElementById('newNumber').value,
        complement: document.getElementById('newComplement').value,
        neighborhood: document.getElementById('newNeighborhood').value,
        city: document.getElementById('newCity').value
    };
    
    // API Call: POST /api/v1/clientes/{id}/enderecos
    console.log(`API Call: POST ${API_BASE}/clientes/1/enderecos`);
    console.log('Address data:', addressData);
    
    alert('Endere√ßo adicionado com sucesso!');
    closeAddressModal();
    loadAddresses();
}

function removeAddress(addressId) {
    if (confirm('Tem certeza que deseja remover este endere√ßo?')) {
        // API Call: DELETE /api/v1/clientes/{id}/enderecos/{addressId}
        console.log(`API Call: DELETE ${API_BASE}/clientes/1/enderecos/${addressId}`);
        
        alert('Endere√ßo removido com sucesso!');
        loadAddresses();
    }
}

function editProfile() {
    alert('Funcionalidade de edi√ß√£o de perfil ser√° implementada em breve!');
}

function reorderItems(orderId) {
    console.log(`Reordering items from order ${orderId}`);
    alert('Itens adicionados ao carrinho!');
}

function logout() {
    localStorage.removeItem('algexpress_user');
    window.location.href = 'customer_login.html';
}

// Initialize page
window.onload = function() {
    loadUserData();
};
</script>

</body>
</html>