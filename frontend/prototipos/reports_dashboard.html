<!DOCTYPE html>
<html>
<head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
        rel="stylesheet"
        as="style"
        onload="this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?display=swap&family=Inter%3Awght%40400%3B500%3B700%3B900&family=Noto+Sans%3Awght%40400%3B500%3B700%3B900"
    />
    <title>Relatórios - AlgExpress</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden" style='font-family: Inter, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">
        <!-- Header -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#e7edf4] px-10 py-3">
            <div class="flex items-center gap-4 text-[#0d141c]">
                <div class="size-4">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4H42V17.3333V30.6667H24V44H6V30.6667V17.3333H24V4Z" fill="currentColor"></path>
                    </svg>
                </div>
                <h2 class="text-[#0d141c] text-lg font-bold leading-tight tracking-[-0.015em]">AlgExpress</h2>
            </div>
            <div class="flex flex-1 justify-end gap-8">
                <div class="flex items-center gap-9">
                    <a class="text-[#0d141c] text-sm font-medium leading-normal" href="/dashboard">Dashboard</a>
                    <a class="text-[#0d141c] text-sm font-medium leading-normal" href="/orders">Pedidos</a>
                    <a class="text-[#0d141c] text-sm font-medium leading-normal" href="/customers">Clientes</a>
                    <a class="text-[#0d141c] text-sm font-medium leading-normal" href="/menu">Cardápio</a>
                    <a class="text-[#0d80f2] text-sm font-medium leading-normal" href="/reports">Relatórios</a>
                </div>
                <div
                    class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                    style='background-image: url("https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face");'
                ></div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="px-40 flex flex-1 justify-center py-5">
            <div class="layout-content-container flex flex-col max-w-[1400px] flex-1">
                
                <!-- Page Header -->
                <div class="flex flex-wrap justify-between gap-3 p-4">
                    <div class="flex min-w-72 flex-col gap-3">
                        <p class="text-[#0d141c] tracking-light text-[32px] font-bold leading-tight">Relatórios e Analytics</p>
                        <p class="text-[#49739c] text-sm font-normal leading-normal">Análise detalhada de performance e métricas do negócio</p>
                    </div>
                    
                    <!-- Date Range Selector -->
                    <div class="flex gap-3 items-center">
                        <div class="flex gap-2">
                            <input type="date" id="startDate" class="form-input text-sm border border-[#cedbe8] rounded-lg px-3 py-2" value="2024-01-01">
                            <span class="text-[#49739c] text-sm py-2">até</span>
                            <input type="date" id="endDate" class="form-input text-sm border border-[#cedbe8] rounded-lg px-3 py-2" value="2024-12-31">
                        </div>
                        <button
                            class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#0d80f2] text-slate-50 text-sm font-bold leading-normal tracking-[0.015em]"
                            onclick="updateReports()"
                        >
                            <span class="truncate">Atualizar</span>
                        </button>
                    </div>
                </div>

                <!-- Key Metrics Cards -->
                <div class="flex gap-4 p-4 flex-wrap">
                    <div class="flex min-w-[200px] flex-1 flex-col gap-2 rounded-lg p-6 bg-white border border-[#cedbe8]">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            <p class="text-[#0d141c] text-sm font-medium leading-normal">Receita Total</p>
                        </div>
                        <p class="text-[#0d141c] tracking-light text-2xl font-bold leading-tight" id="totalRevenue">R$ 45.678,90</p>
                        <p class="text-green-600 text-sm font-medium">+12.5% vs período anterior</p>
                    </div>
                    
                    <div class="flex min-w-[200px] flex-1 flex-col gap-2 rounded-lg p-6 bg-white border border-[#cedbe8]">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <p class="text-[#0d141c] text-sm font-medium leading-normal">Pedidos Entregues</p>
                        </div>
                        <p class="text-[#0d141c] tracking-light text-2xl font-bold leading-tight" id="deliveredOrders">342</p>
                        <p class="text-green-600 text-sm font-medium">+8.7% vs período anterior</p>
                    </div>
                    
                    <div class="flex min-w-[200px] flex-1 flex-col gap-2 rounded-lg p-6 bg-white border border-[#cedbe8]">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                            <p class="text-[#0d141c] text-sm font-medium leading-normal">Ticket Médio</p>
                        </div>
                        <p class="text-[#0d141c] tracking-light text-2xl font-bold leading-tight" id="averageTicket">R$ 42,30</p>
                        <p class="text-red-600 text-sm font-medium">-2.3% vs período anterior</p>
                    </div>
                    
                    <div class="flex min-w-[200px] flex-1 flex-col gap-2 rounded-lg p-6 bg-white border border-[#cedbe8]">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                            <p class="text-[#0d141c] text-sm font-medium leading-normal">Tempo Médio Entrega</p>
                        </div>
                        <p class="text-[#0d141c] tracking-light text-2xl font-bold leading-tight" id="avgDeliveryTime">28 min</p>
                        <p class="text-green-600 text-sm font-medium">-15% vs período anterior</p>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="flex gap-6 p-4">
                    
                    <!-- Revenue Chart -->
                    <div class="flex-1 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-[#0d141c]">Receita por Período</h3>
                            <select class="text-sm border border-[#cedbe8] rounded px-2 py-1" onchange="updateRevenueChart()">
                                <option value="daily">Diário</option>
                                <option value="weekly" selected>Semanal</option>
                                <option value="monthly">Mensal</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <!-- Orders Status Pie Chart -->
                    <div class="w-96 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <h3 class="text-lg font-bold text-[#0d141c] mb-4">Status dos Pedidos</h3>
                        <div class="h-64">
                            <canvas id="ordersStatusChart"></canvas>
                        </div>
                    </div>

                </div>

                <!-- Second Row Charts -->
                <div class="flex gap-6 p-4">
                    
                    <!-- Popular Pizzas -->
                    <div class="flex-1 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <h3 class="text-lg font-bold text-[#0d141c] mb-4">Pizzas Mais Vendidas</h3>
                        <div class="h-64">
                            <canvas id="popularPizzasChart"></canvas>
                        </div>
                    </div>

                    <!-- Customer Growth -->
                    <div class="flex-1 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <h3 class="text-lg font-bold text-[#0d141c] mb-4">Crescimento de Clientes</h3>
                        <div class="h-64">
                            <canvas id="customerGrowthChart"></canvas>
                        </div>
                    </div>

                </div>

                <!-- Tables Section -->
                <div class="flex gap-6 p-4">
                    
                    <!-- Top Customers Table -->
                    <div class="flex-1 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <h3 class="text-lg font-bold text-[#0d141c] mb-4">Top Clientes por Pedidos</h3>
                        <div class="overflow-hidden rounded-lg border border-[#cedbe8]">
                            <table class="w-full">
                                <thead>
                                    <tr class="bg-slate-50">
                                        <th class="px-4 py-3 text-left text-[#0d141c] text-sm font-medium">Cliente</th>
                                        <th class="px-4 py-3 text-left text-[#0d141c] text-sm font-medium">Pedidos</th>
                                        <th class="px-4 py-3 text-left text-[#0d141c] text-sm font-medium">Total Gasto</th>
                                    </tr>
                                </thead>
                                <tbody id="topCustomersTable">
                                    <tr class="border-t border-t-[#cedbe8]">
                                        <td class="px-4 py-3 text-[#0d141c] text-sm">João Silva Santos</td>
                                        <td class="px-4 py-3 text-[#49739c] text-sm">23</td>
                                        <td class="px-4 py-3 text-[#0d141c] text-sm font-medium">R$ 987,60</td>
                                    </tr>
                                    <tr class="border-t border-t-[#cedbe8]">
                                        <td class="px-4 py-3 text-[#0d141c] text-sm">Maria Oliveira</td>
                                        <td class="px-4 py-3 text-[#49739c] text-sm">19</td>
                                        <td class="px-4 py-3 text-[#0d141c] text-sm font-medium">R$ 856,40</td>
                                    </tr>
                                    <tr class="border-t border-t-[#cedbe8]">
                                        <td class="px-4 py-3 text-[#0d141c] text-sm">Carlos Roberto</td>
                                        <td class="px-4 py-3 text-[#49739c] text-sm">17</td>
                                        <td class="px-4 py-3 text-[#0d141c] text-sm font-medium">R$ 743,20</td>
                                    </tr>
                                    <tr class="border-t border-t-[#cedbe8]">
                                        <td class="px-4 py-3 text-[#0d141c] text-sm">Ana Paula Silva</td>
                                        <td class="px-4 py-3 text-[#49739c] text-sm">15</td>
                                        <td class="px-4 py-3 text-[#0d141c] text-sm font-medium">R$ 689,50</td>
                                    </tr>
                                    <tr class="border-t border-t-[#cedbe8]">
                                        <td class="px-4 py-3 text-[#0d141c] text-sm">Pedro Henrique</td>
                                        <td class="px-4 py-3 text-[#49739c] text-sm">14</td>
                                        <td class="px-4 py-3 text-[#0d141c] text-sm font-medium">R$ 612,30</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="w-96 bg-white rounded-lg border border-[#cedbe8] p-6">
                        <h3 class="text-lg font-bold text-[#0d141c] mb-4">Métricas de Performance</h3>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span class="text-[#0d141c] text-sm font-medium">Taxa de Entrega no Prazo</span>
                                <span class="text-green-600 text-sm font-bold">94.2%</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span class="text-[#0d141c] text-sm font-medium">Taxa de Cancelamento</span>
                                <span class="text-red-600 text-sm font-bold">3.1%</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span class="text-[#0d141c] text-sm font-medium">Pedidos por Hora (Pico)</span>
                                <span class="text-blue-600 text-sm font-bold">12.5</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span class="text-[#0d141c] text-sm font-medium">Receita de Entregas</span>
                                <span class="text-purple-600 text-sm font-bold">R$ 2.340,80</span>
                            </div>
                            
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                                <span class="text-[#0d141c] text-sm font-medium">Clientes Recorrentes</span>
                                <span class="text-orange-600 text-sm font-bold">67.8%</span>
                            </div>
                        </div>
                        
                        <button class="w-full mt-4 bg-[#0d80f2] text-white py-2 rounded-lg text-sm font-medium hover:bg-blue-600" onclick="exportReport()">
                            Exportar Relatório
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<script>
// Global variables
const API_BASE = 'http://localhost:8080/api/v1';
let charts = {};

// Initialize all charts
function initializeCharts() {
    initRevenueChart();
    initOrdersStatusChart();
    initPopularPizzasChart();
    initCustomerGrowthChart();
}

function initRevenueChart() {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    charts.revenue = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6', 'Sem 7', 'Sem 8'],
            datasets: [{
                label: 'Receita (R$)',
                data: [4200, 4800, 3900, 5200, 4600, 5800, 5100, 5900],
                borderColor: '#0d80f2',
                backgroundColor: 'rgba(13, 128, 242, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'R$ ' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });
}

function initOrdersStatusChart() {
    const ctx = document.getElementById('ordersStatusChart').getContext('2d');
    charts.ordersStatus = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Entregues', 'Em Entrega', 'Prontos', 'Em Preparo', 'Cancelados'],
            datasets: [{
                data: [342, 23, 15, 8, 12],
                backgroundColor: [
                    '#22c55e',
                    '#3b82f6',
                    '#f59e0b',
                    '#ef4444',
                    '#6b7280'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

function initPopularPizzasChart() {
    const ctx = document.getElementById('popularPizzasChart').getContext('2d');
    charts.popularPizzas = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Margherita', 'Pepperoni', 'Quattro Formaggi', 'Calabresa', 'Portuguesa'],
            datasets: [{
                label: 'Vendas',
                data: [89, 76, 64, 58, 45],
                backgroundColor: '#0d80f2'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function initCustomerGrowthChart() {
    const ctx = document.getElementById('customerGrowthChart').getContext('2d');
    charts.customerGrowth = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'],
            datasets: [{
                label: 'Novos Clientes',
                data: [12, 19, 15, 23, 18, 25, 22, 30],
                borderColor: '#22c55e',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function updateReports() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;
    
    // API Calls for updating reports
    console.log(`API Call: GET ${API_BASE}/relatorios/revenue?startDate=${startDate}&endDate=${endDate}`);
    console.log(`API Call: GET ${API_BASE}/relatorios/dashboard?startDate=${startDate}&endDate=${endDate}`);
    console.log(`API Call: GET ${API_BASE}/relatorios/customers/most-orders?startDate=${startDate}&endDate=${endDate}`);
    console.log(`API Call: GET ${API_BASE}/relatorios/pizzas/most-popular?startDate=${startDate}&endDate=${endDate}`);
    
    // Update metrics
    updateKeyMetrics();
    updateTopCustomers();
    
    // Update charts with new data
    updateChartsData();
}

function updateRevenueChart() {
    const period = event.target.value;
    console.log(`Updating revenue chart for period: ${period}`);
    
    // This would update the chart data based on the selected period
    // API Call would be made to get data for the specific period
}

function updateKeyMetrics() {
    // API Calls for key metrics
    console.log(`API Call: GET ${API_BASE}/pedidos/statistics/revenue-by-date-range`);
    console.log(`API Call: GET ${API_BASE}/pedidos/statistics/count-by-status?status=DELIVERED`);
    console.log(`API Call: GET ${API_BASE}/pedidos/statistics/average-order-total`);
    
    // These would update the metric cards with real data
}

function updateTopCustomers() {
    // API Call: GET /api/v1/relatorios/customers/most-orders
    console.log(`API Call: GET ${API_BASE}/relatorios/customers/most-orders`);
    
    // This would populate the top customers table with real data
}

function updateChartsData() {
    // Update all charts with new data from API calls
    // Each chart would get updated data based on the selected date range
    
    // Example of updating revenue chart
    if (charts.revenue) {
        // New data would come from API
        charts.revenue.data.datasets[0].data = [5200, 5800, 4900, 6200, 5600, 6800, 6100, 6900];
        charts.revenue.update();
    }
}

function exportReport() {
    // API Call to generate and download report
    console.log(`API Call: GET ${API_BASE}/relatorios/export?format=PDF&startDate=${document.getElementById('startDate').value}&endDate=${document.getElementById('endDate').value}`);
    
    alert('Relatório será gerado e enviado por email em alguns minutos.');
}

// Initialize page
window.onload = function() {
    initializeCharts();
    updateReports();
};
</script>

</body>
</html>